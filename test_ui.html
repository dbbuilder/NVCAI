<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVC AI Facilitator - Test Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 800px;
            padding: 30px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .nvc-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .step {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .step.active {
            border-color: #667eea;
            background: #e8f2ff;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: bold;
        }
        
        .step-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .step-description {
            font-size: 0.9em;
            color: #666;
        }
        
        .conversation-area {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 200px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            max-width: 80%;
        }
        
        .user-message {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .ai-message {
            background: white;
            border: 1px solid #ddd;
        }
        
        .guidance-box {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .guidance-title {
            font-weight: 600;
            color: #155724;
            margin-bottom: 8px;
        }
        
        .guidance-text {
            color: #155724;
        }
        
        .example-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .example-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 8px;
        }
        
        .example-text {
            color: #856404;
        }
        
        .suggestions-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        
        .suggestions-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .suggestion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .suggestion-btn {
            background: #e8f2ff;
            border: 1px solid #667eea;
            color: #667eea;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .suggestion-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .vocabulary-section {
            margin-top: 15px;
        }
        
        .vocabulary-title {
            font-weight: 600;
            color: #555;
            margin-bottom: 10px;
        }
        
        .vocabulary-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .vocabulary-btn {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 6px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }
        
        .vocabulary-btn:hover {
            background: #ffc107;
            color: white;
        }
        
        .nvc-summary {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            border: 2px solid #28a745;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.1);
        }
        
        .summary-title {
            color: #155724;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .summary-content {
            color: #155724;
            line-height: 1.7;
            white-space: pre-line;
        }
        
        .summary-content h2 {
            color: #2c5530;
            border-bottom: 2px solid #28a745;
            padding-bottom: 8px;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .summary-content h3 {
            color: #2c5530;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .summary-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .summary-content li {
            margin: 5px 0;
        }
        
        .summary-content strong {
            color: #1e4620;
            font-weight: 600;
        }
        
        .summary-content em {
            font-style: italic;
            background: rgba(40, 167, 69, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .conversation-complete-message {
            text-align: center;
            padding: 15px;
            background: #d4edda;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
            color: #155724;
        }
        
        /* Authentication Styles */
        .auth-section {
            background: #f8f9fa;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .auth-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
        }
        
        .auth-inputs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .auth-input {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            outline: none;
            transition: border-color 0.3s ease;
        }
        
        .auth-input:focus {
            border-color: #007bff;
        }
        
        .auth-button {
            padding: 15px 25px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
            margin-top: 5px;
        }
        
        .auth-button:hover {
            background: #0056b3;
            box-shadow: 0 6px 16px rgba(0,123,255,0.4);
            transform: translateY(-2px);
        }
        
        .voice-button {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 50px;
        }
        
        .voice-button:hover {
            background: #218838;
            transform: scale(1.05);
        }
        
        .voice-button.recording {
            background: #dc3545;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .speak-button {
            background: #17a2b8;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 0.9em;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.3s ease;
            vertical-align: middle;
        }
        
        .speak-button:hover {
            background: #138496;
            transform: scale(1.1);
        }

        .input-area {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .message-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .message-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .send-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        
        .send-button:hover {
            background: #5a6fd8;
        }
        
        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.loading {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>NVC AI Facilitator</h1>
            <p>Practice Non-Violent Communication with AI guidance</p>
        </div>
        
        <div class="nvc-steps">
            <div class="step" id="observation-step">
                <div class="step-number">1</div>
                <div class="step-title">Observation</div>
                <div class="step-description">What did you see or hear?</div>
            </div>
            <div class="step" id="feeling-step">
                <div class="step-number">2</div>
                <div class="step-title">Feeling</div>
                <div class="step-description">How do you feel?</div>
            </div>
            <div class="step" id="need-step">
                <div class="step-number">3</div>
                <div class="step-title">Need</div>
                <div class="step-description">What do you need?</div>
            </div>
            <div class="step" id="request-step">
                <div class="step-number">4</div>
                <div class="step-title">Request</div>
                <div class="step-description">What would you like to request?</div>
            </div>
        </div>
        
        <div class="conversation-area" id="conversation">
            <!-- Dynamic messages will be added here -->
        </div>
        
        <div id="status" class="status" style="display: none;"></div>
        
        <div id="suggestions" class="suggestions-section" style="display: none;">
            <div class="suggestions-title">‚ú® Suggested Responses</div>
            <div id="suggestionButtons" class="suggestion-buttons"></div>
            
            <div class="vocabulary-section">
                <div class="vocabulary-title">üìö NVC Vocabulary</div>
                <div id="vocabularyButtons" class="vocabulary-buttons"></div>
            </div>
        </div>
        
        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <div class="auth-title">üîê Authentication Required</div>
            <div class="auth-inputs">
                <input 
                    type="email" 
                    id="emailInput" 
                    class="auth-input" 
                    placeholder="Enter your email"
                >
                <input 
                    type="password" 
                    id="passwordInput" 
                    class="auth-input" 
                    placeholder="Enter password"
                >
                <button onclick="authenticate()" class="auth-button" id="authButton">Login</button>
            </div>
        </div>

        <div class="input-area" id="chatArea" style="display: none;">
            <input 
                type="text" 
                id="messageInput" 
                class="message-input" 
                placeholder="Type your message here..."
                onkeypress="handleKeyPress(event)"
            >
            <button onclick="startVoiceInput()" class="voice-button" id="voiceButton" title="Click to speak">üé§</button>
            <button onclick="sendMessage()" class="send-button" id="sendButton">Send</button>
        </div>
    </div>

    <script>
        // Use current domain for deployment, localhost for development
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:19000/api/v1'
            : `${window.location.protocol}//${window.location.host}/api/v1`;
        let conversationHistory = [];
        let currentStep = 'observation';
        let conversationComplete = false;
        let isAuthenticated = false;
        let userCredentials = { email: '', password: '' };
        let recognition = null;
        let isListening = false;

        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
            
            if (type !== 'loading') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        function updateActiveStep(step) {
            // Remove active class from all steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // Add active class to current step
            const stepMap = {
                'observation': 'observation-step',
                'feeling': 'feeling-step', 
                'need': 'need-step',
                'request': 'request-step'
            };
            
            if (stepMap[step]) {
                document.getElementById(stepMap[step]).classList.add('active');
            }
        }

        function addMessage(message, isUser = false) {
            const conversation = document.getElementById('conversation');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
            
            if (isUser) {
                messageDiv.innerHTML = `<strong>You:</strong> ${message}`;
            } else {
                messageDiv.innerHTML = `
                    <strong>NVC AI Facilitator:</strong> ${message}
                    <button onclick="speakMessage('${message.replace(/'/g, "\\'")}')" class="speak-button" title="Read aloud">üîä</button>
                `;
            }
            
            conversation.appendChild(messageDiv);
            conversation.scrollTop = conversation.scrollHeight;
        }

        function speakMessage(message) {
            if ('speechSynthesis' in window) {
                // Stop any current speech
                speechSynthesis.cancel();
                
                // Clean the message text (remove HTML and extra formatting)
                const cleanMessage = message.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ');
                
                const utterance = new SpeechSynthesisUtterance(cleanMessage);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                
                // Try to use a pleasant voice
                const voices = speechSynthesis.getVoices();
                const preferredVoice = voices.find(voice => 
                    voice.name.includes('Google') || 
                    voice.name.includes('Natural') ||
                    voice.name.includes('Enhanced') ||
                    (voice.lang.startsWith('en') && voice.localService)
                );
                
                if (preferredVoice) {
                    utterance.voice = preferredVoice;
                }
                
                speechSynthesis.speak(utterance);
            } else {
                showStatus('Text-to-speech not supported in this browser', 'error');
            }
        }

        function addGuidance(guidance, example) {
            const conversation = document.getElementById('conversation');
            
            if (guidance) {
                const guidanceDiv = document.createElement('div');
                guidanceDiv.className = 'guidance-box';
                guidanceDiv.innerHTML = `
                    <div class="guidance-title">üí° NVC Guidance</div>
                    <div class="guidance-text">${guidance}</div>
                `;
                conversation.appendChild(guidanceDiv);
            }
            
            if (example) {
                const exampleDiv = document.createElement('div');
                exampleDiv.className = 'example-box';
                exampleDiv.innerHTML = `
                    <div class="example-title">üìù Example</div>
                    <div class="example-text">${example}</div>
                `;
                conversation.appendChild(exampleDiv);
            }
            
            conversation.scrollTop = conversation.scrollHeight;
        }

        function showSuggestions(suggestedResponses, vocabularyOptions) {
            if (conversationComplete) {
                document.getElementById('suggestions').style.display = 'none';
                return;
            }
            
            const suggestionsDiv = document.getElementById('suggestions');
            const suggestionButtons = document.getElementById('suggestionButtons');
            const vocabularyButtons = document.getElementById('vocabularyButtons');
            
            // Clear previous suggestions
            suggestionButtons.innerHTML = '';
            vocabularyButtons.innerHTML = '';
            
            // Add suggested response buttons
            if (suggestedResponses && suggestedResponses.length > 0) {
                suggestedResponses.forEach(response => {
                    const button = document.createElement('button');
                    button.className = 'suggestion-btn';
                    button.textContent = response;
                    button.onclick = () => selectSuggestion(response);
                    suggestionButtons.appendChild(button);
                });
            }
            
            // Add vocabulary buttons
            if (vocabularyOptions && vocabularyOptions.length > 0) {
                vocabularyOptions.forEach(vocab => {
                    const button = document.createElement('button');
                    button.className = 'vocabulary-btn';
                    button.textContent = vocab;
                    button.onclick = () => insertVocabulary(vocab);
                    vocabularyButtons.appendChild(button);
                });
            }
            
            // Show suggestions section
            suggestionsDiv.style.display = 'block';
        }

        function convertMarkdownToHTML(text) {
            // Convert markdown-style formatting to HTML
            return text
                .replace(/### \*\*(.*?)\*\*/g, '<h3><strong>$1</strong></h3>')
                .replace(/## (.*?)$/gm, '<h2>$1</h2>')
                .replace(/### (.*?)$/gm, '<h3>$1</h3>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/^‚Ä¢ (.*?)$/gm, '<li>$1</li>')
                .replace(/^‚úÖ (.*?)$/gm, '<li>‚úÖ $1</li>')
                .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
                .replace(/<\/ul>\s*<ul>/g, '')
                .replace(/---/g, '<hr style="border: 1px solid #28a745; margin: 20px 0;">')
                .replace(/\n\n/g, '<br><br>');
        }

        function showNVCSummary(summary) {
            const conversation = document.getElementById('conversation');
            
            // Add completion message
            const completionDiv = document.createElement('div');
            completionDiv.className = 'conversation-complete-message';
            completionDiv.innerHTML = 'üéâ <strong>NVC Conversation Complete!</strong> Here\'s your personalized guidance:';
            conversation.appendChild(completionDiv);
            
            // Convert summary to HTML and add it
            const htmlSummary = convertMarkdownToHTML(summary);
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'nvc-summary';
            summaryDiv.innerHTML = `
                <div class="summary-title">üìã Your NVC Action Plan</div>
                <div class="summary-content">${htmlSummary}</div>
            `;
            conversation.appendChild(summaryDiv);
            
            // Hide suggestions and input
            document.getElementById('suggestions').style.display = 'none';
            document.getElementById('messageInput').placeholder = 'Conversation completed! Start a new conversation to continue.';
            document.getElementById('sendButton').textContent = 'New Conversation';
            document.getElementById('sendButton').onclick = () => location.reload();
            
            conversation.scrollTop = conversation.scrollHeight;
        }

        function selectSuggestion(suggestion) {
            document.getElementById('messageInput').value = suggestion;
            document.getElementById('messageInput').focus();
        }

        function insertVocabulary(vocab) {
            const input = document.getElementById('messageInput');
            const currentValue = input.value;
            
            // Add vocabulary to current input
            if (currentValue.trim() === '') {
                input.value = vocab;
            } else {
                input.value = currentValue + ' ' + vocab;
            }
            
            input.focus();
        }

        async function sendMessage() {
            if (conversationComplete) {
                location.reload();
                return;
            }
            
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendButton = document.getElementById('sendButton');
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to conversation
            addMessage(message, true);
            conversationHistory.push(message);
            
            // Clear input
            input.value = '';
            
            showStatus('AI is thinking...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/nvc/conversation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        email: userCredentials.email,
                        password: userCredentials.password,
                        nvc_step: currentStep,
                        conversation_history: conversationHistory
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Add AI response
                addMessage(data.response);
                conversationHistory.push(data.response);
                
                // Check if conversation is complete
                if (data.conversation_complete && data.nvc_summary) {
                    conversationComplete = true;
                    showNVCSummary(data.nvc_summary);
                    showStatus('NVC conversation completed!', 'success');
                } else {
                    // Add guidance and example
                    addGuidance(data.guidance, data.example);
                    
                    // Show suggestions and vocabulary options
                    showSuggestions(data.suggested_responses, data.vocabulary_options);
                    
                    // Update current step
                    currentStep = data.current_step;
                    updateActiveStep(currentStep);
                    
                    showStatus('Response received', 'success');
                }
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('Sorry, I encountered an error connecting to the NVC AI service. Please try again in a moment.');
                showStatus(`Error: ${error.message}`, 'error');
            } finally {
                if (!conversationComplete) {
                    sendButton.disabled = false;
                    input.disabled = false;
                    input.focus();
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                if (isAuthenticated) {
                    sendMessage();
                } else {
                    authenticate();
                }
            }
        }

        async function authenticate() {
            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value;
            
            if (!email || !password) {
                showStatus('Please enter both email and password', 'error');
                return;
            }
            
            try {
                showStatus('Authenticating...', 'loading');
                
                const response = await fetch(`${API_BASE}/nvc/auth`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    isAuthenticated = true;
                    userCredentials = { email, password };
                    
                    // Hide auth section, show chat
                    document.getElementById('authSection').style.display = 'none';
                    document.getElementById('chatArea').style.display = 'flex';
                    
                    showStatus('‚úÖ Welcome to NVC AI Facilitator!', 'success');
                    
                    // Add initial AI message
                    addMessage('Hello! I\'m here to help you practice Non-Violent Communication. Share a situation you\'d like to work through, and I\'ll guide you through the four steps of NVC: Observation, Feelings, Needs, and Requests. What would you like to talk about?');
                    
                    document.getElementById('messageInput').focus();
                } else {
                    const errorData = await response.json();
                    showStatus(errorData.detail || 'Authentication failed', 'error');
                }
            } catch (error) {
                console.error('Auth error:', error);
                showStatus('Authentication error - please try again', 'error');
            }
        }

        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.interimResults = false;
                recognition.lang = 'en-US';
                
                recognition.onstart = function() {
                    isListening = true;
                    const voiceButton = document.getElementById('voiceButton');
                    voiceButton.classList.add('recording');
                    voiceButton.textContent = 'üî¥';
                    showStatus('Listening... speak now', 'loading');
                };
                
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    const messageInput = document.getElementById('messageInput');
                    messageInput.value = transcript;
                    messageInput.focus(); // Focus the input to show the text clearly
                    showStatus(`Voice input: "${transcript}"`, 'success');
                };
                
                recognition.onend = function() {
                    isListening = false;
                    const voiceButton = document.getElementById('voiceButton');
                    voiceButton.classList.remove('recording');
                    voiceButton.textContent = 'üé§';
                };
                
                recognition.onerror = function(event) {
                    showStatus('Voice recognition error: ' + event.error, 'error');
                    isListening = false;
                    const voiceButton = document.getElementById('voiceButton');
                    voiceButton.classList.remove('recording');
                    voiceButton.textContent = 'üé§';
                };
            }
        }

        function startVoiceInput() {
            if (!recognition) {
                showStatus('Voice recognition not supported in this browser. Try Chrome or Edge.', 'error');
                return;
            }
            
            if (isListening) {
                recognition.stop();
                showStatus('Voice input stopped', 'success');
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Voice recognition error:', error);
                    showStatus('Could not start voice recognition. Check microphone permissions.', 'error');
                }
            }
        }

        // Test backend connection on page load
        window.onload = async function() {
            // Initialize voice recognition
            initVoiceRecognition();
            
            // Test backend connection
            try {
                const response = await fetch(`${API_BASE}/nvc/examples`);
                if (response.ok) {
                    showStatus('‚úÖ NVC AI backend connected - please login to continue', 'success');
                } else {
                    throw new Error('Backend connection failed');
                }
            } catch (error) {
                showStatus('‚ùå Backend connection failed', 'error');
                console.error('Connection error:', error);
            }
            
            // Focus on email input for authentication
            document.getElementById('emailInput').focus();
        };
    </script>
</body>
</html>